<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/static/img/favicon.ico" />
    <title>Devops Data Deployment for Oracle - Lee Lindley Scratchpad</title>
    <meta name="author" content="Lee Lindley" />
    <meta name="description" content="Devops Data Deployment for Oracle" />
    <meta name="keywords" content="Devops Data Deployment for Oracle, Lee Lindley Scratchpad, plsql, sql, oracle" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
    <meta content="" property="fb:app_id">
    <meta content="Lee Lindley Scratchpad" property="og:site_name">

    

    
      <meta content="Devops Data Deployment for Oracle" property="og:title">
      <meta content="article" property="og:type">
    

    
      <meta content="Posts on Technical Subjects, mostly Oracle and Linux" property="og:description">
    

    
      <meta content="https://lee-lindley.github.io/plsql/sql/oracle/2022/03/28/Devops-Oracle-Deploy.html" property="og:url">
    

    
      <meta content="2022-03-28T10:00:00-04:00" property="article:published_time">
      <meta content="https://lee-lindley.github.io/about/" property="article:author">
    

    

    
      
        <meta content="plsql" property="article:section">
      
    

    
      
        <meta content="oracle" property="article:tag">
      
        <meta content="sql" property="article:tag">
      
        <meta content="plsql" property="article:tag">
      
        <meta content="devops" property="article:tag">
      
        <meta content="deploy" property="article:tag">
      
        <meta content="CLOB" property="article:tag">
      
    

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">

    
      <meta name="twitter:title" content="Devops Data Deployment for Oracle">
    

    
      <meta name="twitter:url" content="https://lee-lindley.github.io/plsql/sql/oracle/2022/03/28/Devops-Oracle-Deploy.html">
    

    
      <meta name="twitter:description" content="Posts on Technical Subjects, mostly Oracle and Linux">
    

    

    <!-- Font awesome icons -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/static/css/syntax.css">
    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/super-search.css">
    <link rel="stylesheet" href="/static/css/thickbox.css">
    <link rel="stylesheet" href="/static/css/projects.css">
    <link rel="stylesheet" href="/static/css/main.css">

    
  </head>
  <body>
    <div class="container">
      <div class="col-sm-3">
        <div class="fixed-condition">
          <h1 class="author-name"><a href="/">Lee Lindley</a></h1>
          
            <div class="profile-about">
              I'm Just Another Perl Hacker who wound up in a big Oracle Database playground
            </div>
          
          <div class="social">
            <ul>
              
                <li><a href="https://linkedin.com/in/lee-lindley" target="_blank"><i class="fa fa-linkedin"></i></a></li>
              
                <li><a href="https://github.com/lee-lindley" target="_blank"><i class="fa fa-github"></i></a></li>
              
            </ul>
          </div>
          <div class="search" id="js-search">
            <input type="text" placeholder="(sitemap)~$ type to search" class="search__input form-control" id="js-search__input">
            <ul class="search__results" id="js-search__results"></ul>
          </div>
          <hr />
          <ul class="sidebar-nav">
            <strong>Navigation</strong>
            <li><a href="/">Home</a></li>
            
              <li><a class="about" href="/about/">About Me</a></li>
            
              <li><a class="about" href="/projects/">My Projects</a></li>
            
              <li><a class="about" href="/feed.xml">XML Feed</a></li>
            
          </ul>
        </div>
        <!-- end /.fixed-condition -->
      </div>
      <div class="col-sm-8 col-offset-1 main-layout">
        <header class="post-header">
  <h1 class="post-title">Devops Data Deployment for Oracle</h1>
</header>

<span class="time">28 Mar 2022</span>

  <span class="categories">
    &raquo; <a href="/category/plsql">plsql</a>, <a href="/category/sql">sql</a>, <a href="/category/oracle">oracle</a>
  </span>


<div class="content">
  <div class="post"><h1 id="introduction">Introduction</h1>

<p>Most large corporations have adopted some form of <strong>Continuous Improvement</strong> (CI)
strategy with a <strong>Devops</strong> build and deploy component. 
The people who manage and direct these operations tend to
be Web guys and the tools tend to focus on deploying Web applications (this includes
middleware component on Java and .NET servers). If I am
guilty of stereotyping incorrectly, please tell me about organizations with 
a broader focus. I could be wrong, but that is what I have observed so far.</p>

<p>Other application types are supported, just not as first class citizens.
Specifically, database application deployment is a red-headed step-child
of Devops. I’m not blaming the Devops guys either. We database practioners
are likely guilty of obstruction. Any tool other than what we know works
will be looked upon with suspicion.</p>

<h1 id="how-can-we-deploy">How Can We Deploy?</h1>

<p>We need to deploy database application code (packages, table definitions, etc..)
and we need to deploy data (configuration table entries for example).</p>

<p>We have a suite of client tools we can use as Oracle clients for deploying
code and data manually, all of which require providing or storing a password:</p>

<ul>
  <li>SQL*PLUS</li>
  <li>imp</li>
  <li>sqlldr</li>
  <li>external tables (assuming you can deliver files to a database directory)</li>
  <li>sqlCL</li>
  <li>sqlDeveloper</li>
  <li>Toad</li>
</ul>

<p>We can rule out the gui tools <em>SqlDeveloper</em> and <em>Toad</em>. These are not suitable for automated
deployment.</p>

<p><em>SQL*PLUS</em> is perfectly adequate for deploying our code to the database. Oracle uses it to 
deploy database code and patches. We have
all been using <em>SQL*PLUS</em> for as long as we have used Oracle. It is clunky, limiting and antiquated,
but it works and we know how to make it do the needful.</p>

<p>Strangely, <em>sqlCL</em> does not seem well supported. I know some reasons for that including
security concerns with having Java client software on servers, but the
primary reason is likely inertia. This is a shame because <em>sqlCl</em> supports CSV file 
loading, which would address one of our two deployment needs.</p>

<p>I have not seen a Devops deployment configuration that uses anything other than <em>SQL*PLUS</em>
to deploy code. If there are some, my guess is the database application guys are less
than thrilled. I could be wrong.</p>

<h1 id="deploying-data">Deploying Data</h1>

<p>For batch operations we have mechanisms for transfering files between production
systems and/or with outside vendors. We have custom processes using
<em>sqlldr</em>, External tables and perhaps an ETL tool to import the data from those files. 
Yet the mechanisms
we have for slinging files around in a production environment are probably not supported
through Devops.</p>

<p>We have files in our build that are on the deployment server and we have a <em>SQL*PLUS</em> client.</p>

<p>Traditionally when faced with this we resort to what I call “stupid data load.” We
create a series of Insert or Merge statements with hard coded data and run those
in <em>SQL*PLUS</em>. Maybe we get a little more ambitious and create a single INSERT
or MERGE statement with a series of SELECT FROM DUAL UNION ALL … statements
providing the input. It is still “stupid data load.” Works fine for a small number of
records. Not so fine when you need to create several thousand records.</p>

<p>If Devops configured a capability to use <em>sqlldr</em>, we could do what we must. The use case
for it is limited though and the firm may not choose to invest the resources necessary
to configure and manage that capability.</p>

<h1 id="an-alternative-for-loading-data-with-sqlplus">An Alternative for Loading Data with SQL*PLUS</h1>

<p>Using tools provided in <a href="https://github.com/lee-lindley/plsql_utilities">plsql_utilities</a> we can
build deployment scripts that run in <em>SQL*PLUS</em> handling relatively large amounts of
data as Comma Separated Value (CSV) records efficiently. 
Not as efficiently as using <em>sqlldr</em>, but good enough.</p>

<p>From the documentation at <a href="https://github.com/lee-lindley/plsql_utilities/tree/main/app_csv_pkg">plsql_utilities/app_csv_pkg</a>…</p>

<p>Read the data from a table (with an optional WHERE clause) and convert it
into a CSV CLOB with a header row. Break the CLOB into a set of quoted
string literals. Generate a script that</p>

<ol>
  <li>Creates a Private Temporary Table from the CLOB (input as contactenated string literals).</li>
  <li>Inserts or Merges records from the PTT into the target Table</li>
</ol>

<p>We call the deployment generator:</p>

<div class="language-plsql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">SELECT</span> <span class="n">APP_CSV_PKG</span><span class="p">.</span><span class="n">gen_deploy_merge</span><span class="p">(</span>
    <span class="n">p_table_name</span>    <span class="o">=&gt;</span> <span class="o">'</span><span class="s1">MY_TABLE_NAME</span><span class="o">'</span>
    <span class="p">,</span><span class="n">p_key_cols</span>     <span class="o">=&gt;</span> <span class="o">'</span><span class="s1">ID</span><span class="o">'</span>
    <span class="p">,</span><span class="n">p_where_clause</span> <span class="o">=&gt;</span> <span class="o">'</span><span class="s1">id &lt;= 10</span><span class="o">'</span>
<span class="p">)</span> <span class="kr">FROM</span> <span class="n">DUAL</span><span class="p">;</span>
</code></pre></div></div>

<p>That provides the following script as a CLOB in your query result. Note that
if the size of the CSV CLOB holding the records was greater than 32767, 
it would be represented by a concatenated set of quoted literals instead
of just one as shown here.</p>

<div class="language-plsql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">BEGIN</span>
    <span class="n">APP_CSV_PKG</span><span class="p">.</span><span class="n">create_ptt_csv</span><span class="p">(</span><span class="o">q'{</span><span class="sx">"ID","MSG","DT"
1,"testing...","03/26/2022"
2,"testing...","03/27/2022"
3,"testing...","03/28/2022"
4,"testing...","03/29/2022"
5,"testing...","03/30/2022"
6,"testing...","03/31/2022"
7,"testing...","04/01/2022"
8,"testing...","04/02/2022"
9,"testing...","04/03/2022"
10,"testing...","04/04/2022"
</span><span class="o">}'</span>
<span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
<span class="k">MERGE</span> <span class="kr">INTO</span> <span class="n">MY_TABLE_NAME</span> <span class="n">t</span>
<span class="k">USING</span> <span class="p">(</span>
    <span class="kr">SELECT</span> <span class="o">*</span>
    <span class="kr">FROM</span> <span class="n">ora$ptt_csv</span>
<span class="p">)</span> <span class="n">q</span>
<span class="kr">ON</span> <span class="p">(</span>
    <span class="n">t</span><span class="p">.</span><span class="o">"</span><span class="nv">ID</span><span class="o">"</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="o">"</span><span class="nv">ID</span><span class="o">"</span>
<span class="p">)</span>
<span class="kr">WHEN</span> <span class="kr">MATCHED</span> <span class="kr">THEN</span> <span class="kr">UPDATE</span> <span class="kr">SET</span>
    <span class="n">t</span><span class="p">.</span><span class="o">"</span><span class="nv">MSG</span><span class="o">"</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="o">"</span><span class="nv">MSG</span><span class="o">"</span>
    <span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="o">"</span><span class="nv">DT</span><span class="o">"</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="o">"</span><span class="nv">DT</span><span class="o">"</span>
<span class="kr">WHEN</span> <span class="kr">NOT</span> <span class="kr">MATCHED</span> <span class="kr">THEN</span> <span class="kr">INSERT</span><span class="p">(</span>
    <span class="o">"</span><span class="nv">ID</span><span class="o">"</span><span class="p">,</span> <span class="o">"</span><span class="nv">MSG</span><span class="o">"</span><span class="p">,</span> <span class="o">"</span><span class="nv">DT</span><span class="o">"</span>
<span class="p">)</span> <span class="kr">VALUES</span> <span class="p">(</span>
    <span class="n">q</span><span class="p">.</span><span class="o">"</span><span class="nv">ID</span><span class="o">"</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="o">"</span><span class="nv">MSG</span><span class="o">"</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="o">"</span><span class="nv">DT</span><span class="o">"</span>
<span class="p">);</span>
<span class="k">COMMIT</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="conclusion">Conclusion</h1>

<p>I explored multiple mechanisms to avoid “stupid data load.” The obvious best choice would be if the right
tools for the job like <em>sqlldr</em>, <em>imp</em>, or <em>sqlCL</em> were available, but we play the hand we are dealt. If you
are stuck with <em>SQL*PLUS</em>, this package can be a solution.</p>

</div>
</div>


  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
            
            <div class="panel-body">
              <h4>Related Posts</h4>
              <ul>
            
                <li class="relatedPost">
                  <a href="https://lee-lindley.github.io/plsql/sql/2022/03/20/Ruby-Rouge-Lexer-PLSQL.html">A Ruby/Rouge Lexer Class for Oracle PL/SQL</a>
                  
                    (Categories: <a href="/category/plsql">plsql</a>, <a href="/category/sql">sql</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="https://lee-lindley.github.io/oracle/sql/2022/03/06/Staging_Tables_vs_With.html">Staging Tables vs Single SQL</a>
                  
                    (Categories: <a href="/category/oracle">oracle</a>, <a href="/category/sql">sql</a>)
                  
                </li>
          
          
        
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="https://lee-lindley.github.io/oracle/sql/plsql/perl/2022/01/24/CSV-Clob-Inline-External.html">Inline External Tables for CSV Load</a>
                  
                    (Categories: <a href="/category/oracle">oracle</a>, <a href="/category/sql">sql</a>, <a href="/category/plsql">plsql</a>, <a href="/category/perl">perl</a>)
                  
                </li>
          
          
        
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="https://lee-lindley.github.io/oracle/sql/plsql/perl/2022/01/23/CSV-Clob-PTT.html">CSV Clob and Private Temporary Table</a>
                  
                    (Categories: <a href="/category/oracle">oracle</a>, <a href="/category/sql">sql</a>, <a href="/category/plsql">plsql</a>, <a href="/category/perl">perl</a>)
                  
                </li>
          
          
        
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="https://lee-lindley.github.io/oracle/sql/plsql/2022/01/22/Hiding-Data-Oracle.html">Protecting/Hiding Data in Oracle</a>
                  
                    (Categories: <a href="/category/oracle">oracle</a>, <a href="/category/sql">sql</a>, <a href="/category/plsql">plsql</a>)
                  
                </li>
          
          
        
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="https://lee-lindley.github.io/oracle/plsql/html/2022/01/18/HTML-Table-PLSQL-Redux.html">HTML Table Markup Redux</a>
                  
                    (Categories: <a href="/category/oracle">oracle</a>, <a href="/category/plsql">plsql</a>, <a href="/category/html">html</a>)
                  
                </li>
          
          
        
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
    
        
          
      
          
      
          
      
    
  
  
  </ul>
</div>


<div class="PageNavigation">
  
    <a class="prev" href="/plsql/sql/2022/03/20/Ruby-Rouge-Lexer-PLSQL.html">&laquo; A Ruby/Rouge Lexer Class for Oracle PL/SQL</a>
  
  
</div>

<div class="disqus-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* <![CDATA[ */
    var disqus_shortname = "leelindleyscratchpad";
    var disqus_identifier = "https://lee-lindley.github.io_Devops Data Deployment for Oracle";
    var disqus_title = "Devops Data Deployment for Oracle";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    /* ]]> */
  </script>
</div>

        <footer>
          &copy; Lee Lindley
          
            - <a href="https://github.com/lee-lindley">https://github.com/lee-lindley</a> - Powered by Jekyll.
          
          <div class="btn-github" style="float:right;">
            <iframe src="https://ghbtns.com/github-btn.html?user=agusmakmun&repo=agusmakmun.github.io&type=star&count=true" frameborder="0" scrolling="0" width="100" height="20px"></iframe>
            <iframe src="https://ghbtns.com/github-btn.html?user=agusmakmun&repo=agusmakmun.github.io&type=fork&count=true" frameborder="0" scrolling="0" width="100" height="20px"></iframe>
          </div>
        </footer>
      </div>
      <!-- end /.col-sm-8 -->
    </div>
    <!-- end /.container -->

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/super-search.js"></script>
    <script src="/static/js/thickbox-compressed.js"></script>
    <script src="/static/js/projects.js"></script>
  </body>
</html>

